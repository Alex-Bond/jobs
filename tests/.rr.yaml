jobs:
  # worker pool configuration
  workers:
    command: "php handler.php"
    pool:
      numWorkers: 1
      maxJobs:    1

  # broker configuration
  brokers:
    beanstalk:
      address:  tcp://localhost:11300
      reserve:  1

    sqs:
      region:   us-west-1
      key:      api-key
      secret:   api-secret
      endpoint: http://localhost:9324

    amqp:
      url: amqp://login:password@localhost:5672/
      exchanges:
        - name: testExchange
          type: direct
          durable: false
          autoDelete: false
          internal: false
          noWait: false
          arguments:
            test: test

  # list of broker pipelines associated with endpoints
  pipelines:
    - listen: true
      broker: beanstalk
      options:
        tube: default
      handle:
        - "spiral.jobs.tests.beanstalk.*"

    - listen: true
      broker: sqs
      options:
        queue: default
        attributes:
          MessageRetentionPeriod: "86400"
      handle:
        - "spiral.jobs.tests.sqs.*"

    - listen: true
      broker: local
      handle:
        - "spiral.jobs.tests.local.*"

    - listen: true
      broker: amqp
      options:
        create: true
        queue: test
        durable: false
        autoDelete: false
        exclusive: false
        noWait: false
        arguments:
          test: test
        binds:
          - key: ""
            exchange: "testExchange"
          - key: "logs.*"
            exchange: "testExchange"
      handle:
        - "spiral.jobs.tests.amqp.*"
